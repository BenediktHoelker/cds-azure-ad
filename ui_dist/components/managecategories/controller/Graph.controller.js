sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel"],(e,t)=>{const a=(e,t=null,o="parent_ID")=>e.filter(e=>e[o]===t).map(t=>({...t,children:a(e,t.ID)}));return e.extend("iot.planner.components.managecategories.controller.Graph",{onInit(){const e=new Date;e.setFullYear(2021);const a=new Date;a.setHours(24,0,0,0);const o=new t({dateFrom:e,dateUntil:a,expandToLevel:0});this.setModel(o,"viewModel")},async onBeforeRendering(){await this.getModel().metadataLoaded();this.loadData()},async loadData(){const e=this.getModel();const{dateFrom:t,dateUntil:o}=this.getModel("viewModel").getData();const{results:n}=await e.callFunction(`/getCumulativeCategoryDurations`,{urlParameters:{dateFrom:t,dateUntil:o.toISOString(),excludeEmptyDurations:true}});const l=a(n);e.setProperty("/CategoriesCumulativeDurations",l)},expand(){const e=this.getModel("viewModel");const{expandToLevel:t}=e.getData();this.byId("treeTable").expandToLevel(t+1);e.setProperty("/expandToLevel",t+1)},collapseAll(){this.getModel("viewModel").setProperty("/expandToLevel",0);this.byId("treeTable").collapseAll()},onChangeNumberOfExpandedLevels(){const e=this.byId("treeTable");const{numberOfExpandedLevels:t}=this.getModel("viewModel").getData();e.expandToLevel(t)},onRowsUpdated(e){const t=e.getSource();const a=t.getRows();a.forEach((e,a)=>{if(e.getCells().length===0)return;if(!e.getBindingContext())return;const o=e.getCells()[2];const{relativeDuration:n,relativeAccDuration:l}=e.getBindingContext().getObject();if(t.isExpanded(a)){o.setPercentValue(n);o.setDisplayValue(`${n}%`)}else{o.setPercentValue(l);o.setDisplayValue(`${l}%`)}})}})});