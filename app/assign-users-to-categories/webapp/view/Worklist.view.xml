<mvc:View controllerName="iot.planner.assignuserstocategories.controller.Worklist"
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:t="sap.ui.table"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:smartFilterBar="sap.ui.comp.smartfilterbar"
    xmlns:smartTable="sap.ui.comp.smarttable"
    xmlns:semantic="sap.f.semantic">

    <Page title="{i18n>worklistTitle}">
        <dependents>
            <ResponsivePopover id="editCategoryPopover" placement="Left" initialFocus="titleInput" class="sapUiContentPadding">
                <Input id="titleInput" value="{title}" />
                <customHeader>
                    <Bar>
                        <contentMiddle>
                            <Title text="{worklistView>/popoverTitle}" />
                        </contentMiddle>
                        <contentRight>
                            <Button icon="sap-icon://decline" press="onPressClosePopover"/>
                        </contentRight>
                    </Bar>
                </customHeader>
                <endButton>
                    <Button text="{i18n>OK}" press="onPressSubmitCategory"/>
                </endButton>
            </ResponsivePopover>
        </dependents>

        <t:TreeTable id="treeTable" selectionMode="Multi" rowSelectionChange="onSelect" showNoData="true" rows="{path: '/categoriesLevel0', 
        sorter: {path: 'title'},
        parameters: {numberOfExpandedLevels: 4, arrayNames: ['children']}}" visibleRowCount="20" selectionBehavior="Row" enableBusyIndicator="true" rowActionCount="3" sort="onSort">
            <t:rowActionTemplate>
                <t:RowAction>
                    <t:RowActionItem type="Custom" icon="sap-icon://add" press="onPressAddCategory"/>
                    <!-- <t:RowActionItem type="Custom" icon="sap-icon://edit" press="onPressUpdateCategory"/> -->
                    <t:RowActionItem type="Custom" icon="sap-icon://delete" press="onPressDeleteCategory"/>
                </t:RowAction>
            </t:rowActionTemplate>
            <t:extension>
                <OverflowToolbar >
                    <SearchField search="onSearch" width="100%" />
                </OverflowToolbar>
            </t:extension>
            <t:columns>
                <t:Column label="{i18n>title}" width="30%">
                    <t:template>
                        <Input value="{title}" change="onChangeCategory"/>
                    </t:template>
                </t:Column>
                <t:Column label="{i18n>catNumber}" width="10%">
                    <t:template>
                        <Text text="{catNumber}"/>
                    </t:template>
                </t:Column>
                <t:Column label="{i18n>reference}" width="10%">
                    <t:template>
                        <Input value="{reference}" change="onChangeCategory"/>
                    </t:template>
                </t:Column>
                <!-- <t:Column width="5%">
                    <t:template>
                        <Button type="Ghost" icon="sap-icon://add" press="onPressAdd"/>
                    </t:template>
                </t:Column> -->
                <t:Column label="{i18n>tags}" width="20%">
                    <t:template>
                        <MultiInput tokens="{path: 'tags', templateShareable: false}" suggestionItems="{
                                    path: 'OData>/Tags',
                                    templateShareable: false,
                                    sorter: { path: 'title' }
                                }" showValueHelp="false" tokenUpdate="onUpdateTags" change="onCreateToken">
                            <suggestionItems>
                                <core:Item key="{OData>OData>title}" text="{OData>title}"/>
                            </suggestionItems>
                            <tokens>
                                <Token key="{tag_title}" text="{tag_title}" delete="onDeleteToken"/>
                            </tokens>
                        </MultiInput>
                    </t:template>
                </t:Column>
                <t:Column label="{i18n>members}" width="30%">
                    <t:template>
                        <MultiInput tokens="{path: 'members', templateShareable: false}" suggestionItems="{
                                    path: 'OData>/Users',
                                    templateShareable: false,
                                    sorter: { path: 'displayName' }
                                }" showValueHelp="false" tokenUpdate="onUpdateUsers2Categories">
                            <suggestionItems>
                                <core:Item key="{OData>userPrincipalName}" text="{OData>displayName}"/>
                            </suggestionItems>
                            <tokens >
                                <Token key="{user_userPrincipalName}" text="{displayName}" delete="onDeleteToken"/>
                            </tokens>
                        </MultiInput>
                    </t:template>
                </t:Column>
            </t:columns>
        </t:TreeTable>
        <!-- <footer>
            <Bar>
                <contentRight>
                    <Button type="Emphasized" text="Submit" press="onPressSubmit"/>
                </contentRight>
            </Bar>
        </footer> -->
    </Page>
</mvc:View>