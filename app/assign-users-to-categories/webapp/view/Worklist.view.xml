<mvc:View controllerName="iot.planner.assignuserstocategories.controller.Worklist"
    xmlns="sap.m"
    xmlns:f="sap.ui.layout.form"
    xmlns:core="sap.ui.core"
    xmlns:t="sap.ui.table"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:smartFilterBar="sap.ui.comp.smartfilterbar"
    xmlns:smartTable="sap.ui.comp.smarttable"
    xmlns:semantic="sap.f.semantic">

    <Page title="{i18n>worklistTitle}">
        <dependents>
            <Dialog id="editCategoryDialog" initialFocus="titleInput">
                <f:SimpleForm>
                    <Label text="{i18n>title}"/>
                    <TextArea id="titleInput" value="{title}"/>
                    <Label text="{i18n>shallowReference}"/>
                    <Input id="shallowReferenceInput" value="{shallowReference}" />
                    <Label text="{i18n>absoluteReference}"/>
                    <Input id="referenceInput" value="{absoluteReference}" />

                    <!-- <Label text="{i18n>tags}"/>
                    <MultiInput tokens="{path: 'tags', templateShareable: false}" suggestionItems="{
                                    path: 'OData>/Tags',
                                    templateShareable: false,
                                    sorter: { path: 'title' }
                                }" showValueHelp="false" tokenUpdate="onUpdateTags" change="onCreateToken">
                        <suggestionItems>
                            <core:Item key="{OData>OData>title}" text="{OData>title}"/>
                        </suggestionItems>
                        <tokens>
                            <Token key="{tag_title}" text="{tag_title}" delete="onDeleteToken"/>
                        </tokens>
                    </MultiInput> -->
                    <Label text="{i18n>members}"/>
                    <MultiInput tokens="{path: 'members'}" suggestionItems="{
                                    path: 'OData>/Users',
                                    sorter: { path: 'displayName' }
                                }" showValueHelp="false" tokenUpdate="onUpdateUsers2Categories">
                        <suggestionItems>
                            <core:Item key="{OData>userPrincipalName}" text="{OData>displayName}"/>
                        </suggestionItems>
                        <tokens >
                            <Token key="{user_userPrincipalName}" text="{displayName}" delete="onDeleteToken"/>
                        </tokens>
                    </MultiInput>
                </f:SimpleForm>
                <customHeader>
                    <Bar>
                        <contentMiddle>
                            <Title text="{worklistView>/popoverTitle}" />
                        </contentMiddle>
                        <contentRight>
                            <Button icon="sap-icon://decline" press="onPressClosePopover"/>
                        </contentRight>
                    </Bar>
                </customHeader>
                <endButton>
                    <Button text="{i18n>OK}" press="onPressSubmitCategory"/>
                </endButton>
            </Dialog>
        </dependents>

        <t:TreeTable busy="{worklistView>/busy}" busyIndicatorDelay="1000" id="treeTable" selectionMode="Multi" rowSelectionChange="onSelect" showNoData="true" rows="{path: '/Categories', 
        sorter: [{path: 'shallowReference'}], 
        parameters: {numberOfExpandedLevels: 0, expand : 'members,tags', arrayNames: ['children']}}" visibleRowCount="20" selectionBehavior="Row" rowActionCount="3" sort="onSort">
            <t:noData>
                <Text text=""></Text>
            </t:noData>
            <t:rowActionTemplate>
                <t:RowAction>
                    <t:RowActionItem type="Custom" icon="sap-icon://add" press="onPressAddCategory"/>
                    <t:RowActionItem type="Custom" icon="sap-icon://edit" press="onPressUpdateCategory"/>
                    <!-- <t:RowActionItem type="Custom" icon="sap-icon://delete" press="onPressDeleteCategory"/> -->
                </t:RowAction>
            </t:rowActionTemplate>
            <t:extension>
                <OverflowToolbar >
                    <SearchField search="onSearch" width="100%" />
                    <ToolbarSpacer/>
                    <Button text="{i18n>/delete}" press="onPressDeleteCategory"/>
                </OverflowToolbar>
            </t:extension>
            <t:columns>
                <t:Column label="{i18n>title}" width="30%">
                    <t:template>
                        <Text text="{title}" />
                    </t:template>
                </t:Column>
                <t:Column label="{i18n>childrenLength}" width="5%" hAlign="End">
                    <t:template>
                        <Text text="{= ${children}.length}" />
                    </t:template>
                </t:Column>
                <t:Column label="{i18n>members}" width="5%" hAlign="End">
                    <t:template>
                        <Text text="{= ${members}.length}" />
                    </t:template>
                </t:Column>
                <t:Column label="{i18n>shallowReference}" width="10%">
                    <t:template>
                        <Text text="{shallowReference}"/>
                    </t:template>
                </t:Column>
                <t:Column label="{i18n>absoluteReference}" width="10%">
                    <t:template>
                        <Text text="{absoluteReference}" />
                    </t:template>
                </t:Column>
                <!-- <t:Column label="{i18n>tags}" width="20%">
                    <t:template>
                        <MultiInput tokens="{path: 'tags', templateShareable: false}" suggestionItems="{
                                    path: 'OData>/Tags',
                                    templateShareable: false,
                                    sorter: { path: 'title' }
                                }" showValueHelp="false" tokenUpdate="onUpdateTags" change="onCreateToken">
                            <suggestionItems>
                                <core:Item key="{OData>OData>title}" text="{OData>title}"/>
                            </suggestionItems>
                            <tokens>
                                <Token key="{tag_title}" text="{tag_title}" delete="onDeleteToken"/>
                            </tokens>
                        </MultiInput>
                    </t:template>
                </t:Column>
                <t:Column label="{i18n>members}" width="30%">
                    <t:template>
                        <MultiInput tokens="{path: 'members', templateShareable: false}" suggestionItems="{
                                    path: 'OData>/Users',
                                    templateShareable: false,
                                    sorter: { path: 'displayName' }
                                }" showValueHelp="false" tokenUpdate="onUpdateUsers2Categories">
                            <suggestionItems>
                                <core:Item key="{OData>userPrincipalName}" text="{OData>displayName}"/>
                            </suggestionItems>
                            <tokens >
                                <Token key="{user_userPrincipalName}" text="{displayName}" delete="onDeleteToken"/>
                            </tokens>
                        </MultiInput>
                    </t:template>
                </t:Column> -->
                <!-- <t:Column label="{i18n>totalDuration}" width="10%" hAlign="End">
                    <t:template>
                        <ObjectNumber number="{totalDuration}" textAlign="End"/>
                    </t:template>
                </t:Column> -->
            </t:columns>
        </t:TreeTable>
        <!-- <footer>
            <Bar>
                <contentRight>
                    <Button type="Emphasized" text="Submit" press="onPressSubmit"/>
                </contentRight>
            </Bar>
        </footer> -->
    </Page>
</mvc:View>